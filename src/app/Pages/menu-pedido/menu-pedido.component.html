<!--
  <app-menu></app-menu>
-->

<ion-header>
  <ion-toolbar>
    <ion-back-button defaultHref="home/principal" slot="start"></ion-back-button>
  </ion-toolbar>
  <ion-toolbar>
    <ion-title>
      <div class="ion-text-center preciofinal">
        <ion-text>
          <h1>Total: ${{valorTotal}}</h1>
          <h1>Tiempo elaboración: {{tiempoEstimado}} min</h1>
        </ion-text>
      </div>
    </ion-title>
  </ion-toolbar>

  <ion-toolbar>
    <ion-fab horizontal="start" vertical="center" >
      <ion-chip (click)="modalCarrito(true)">
        <ion-icon name="cart-outline" size="large" color="light"></ion-icon>
        <ion-text>Ver Carrito</ion-text>
      </ion-chip>
    </ion-fab>
    <ion-fab horizontal="end" vertical="center">
      <ion-chip (click)="modalChat(true)">
        <ion-icon name="chatbubbles-outline" size="large" color="light"></ion-icon>
        <ion-text>Consulta al Mozo</ion-text>
      </ion-chip>
    </ion-fab>
  </ion-toolbar>
</ion-header>

<!-- MENU -->

<ion-content *ngIf="!spin">
  <div class="fondo">

    <div class="contenedor-menu">

      <ion-list>
        <ion-item-group>
          <ion-item-divider>
            <ion-label>
              <ion-text color="dark">
                <h2 class="fw-bold">COMIDAS</h2>
              </ion-text>
            </ion-label>
          </ion-item-divider>

          <div *ngFor="let itemCocina of listadoCocina; index as i">
            <ion-item>

              <div class="nombreDescr">
                <ion-text><h4 class="ion-text-center fw-bold">{{itemCocina.producto.nombre}}</h4></ion-text>
                <ion-text class="opacity-75"><p class="ion-text-center">{{itemCocina.producto.descripcion}}</p></ion-text>
              </div>

              <div>
                <div id="collapseExample{{i}}" class="carousel fotosProducto">
                  <div class="carousel-inner">
                    <div class="carousel-item active">
                      <img src="{{itemCocina.producto.img_src[0]}}" alt="..." width="160px" height="160px" class="img-menu">
                    </div>
                    <div class="carousel-item">
                      <img src="{{itemCocina.producto.img_src[1]}}" alt="..." width="160px" height="160px" class="img-menu">
                    </div>
                    <div class="carousel-item">
                      <img src="{{itemCocina.producto.img_src[2]}}" alt="..." width="160px" height="160px" class="img-menu">
                    </div>
                  </div>
                  <button class="carousel-control-prev" type="button" [attr.data-bs-target]="'#collapseExample'+i" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                  </button>
                  <button class="carousel-control-next" type="button" [attr.data-bs-target]="'#collapseExample'+i" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                  </button>
                </div>
                <ion-text><h6 class="ion-text-center fw-bold demora">Demora: {{itemCocina.producto.tiempo_elaboracion}} min</h6></ion-text>
                <ion-text><h3 class="ion-text-center fw-bold precio">${{itemCocina.producto.precio}}</h3></ion-text>
              </div>


              <ion-fab horizontal="start" vertical="bottom" class="sumar">
                <ion-fab-button size="small" (click)="sumarProducto(itemCocina)">
                  <ion-icon name="add"></ion-icon>
                </ion-fab-button>
              </ion-fab>
              <ion-fab vertical="bottom" class="numero">
                <ion-label>
                  <h2 class="fw-bold cantidadItem" *ngIf="itemCocina.cantidad < 10">
                    {{itemCocina.cantidad}}
                  </h2>
                  <h2 class="fw-bold cantidadItem10" *ngIf="itemCocina.cantidad >= 10">
                    {{itemCocina.cantidad}}
                  </h2>
                </ion-label>
              </ion-fab>
              <ion-fab horizontal="start" vertical="bottom">
                <ion-fab-button size="small" (click)="restarProducto(itemCocina)">
                  <ion-icon name="remove-outline"></ion-icon>
                </ion-fab-button>
              </ion-fab>

            </ion-item>

          </div>
        </ion-item-group>

        <ion-item-group>
          <ion-item-divider>
            <ion-label>
              <ion-text color="dark">
                <h2 class="fw-bold">BEBIDAS</h2>
              </ion-text>
            </ion-label>
          </ion-item-divider>

          <div *ngFor="let itemBebida of listadoBebida; index as i">
            <ion-item>

              <div class="nombreDescr">
                <ion-text><h4 class="ion-text-center fw-bold">{{itemBebida.producto.nombre}}</h4></ion-text>
                <ion-text class="opacity-75"><p class="ion-text-center">{{itemBebida.producto.descripcion}}</p></ion-text>
              </div>

              <div>

                <div id="collapseExample2{{i}}" class="carousel fotosProducto">
                  <div class="carousel-inner">
                    <div class="carousel-item active">
                      <img src="{{itemBebida.producto.img_src[0]}}" alt="..." width="160px" height="160px" class="img-menu">
                    </div>
                    <div class="carousel-item">
                      <img src="{{itemBebida.producto.img_src[1]}}" alt="..." width="160px" height="160px" class="img-menu">
                    </div>
                    <div class="carousel-item">
                      <img src="{{itemBebida.producto.img_src[2]}}" alt="..." width="160px" height="160px" class="img-menu">
                    </div>
                  </div>
                  <button class="carousel-control-prev" type="button" [attr.data-bs-target]="'#collapseExample2'+i" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                  </button>
                  <button class="carousel-control-next" type="button" [attr.data-bs-target]="'#collapseExample2'+i" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                  </button>
                </div>
                <ion-text><h6 class="ion-text-center fw-bold demora">Demora: {{itemBebida.producto.tiempo_elaboracion}} min</h6></ion-text>
                <ion-text><h3 class="ion-text-center fw-bold precio">${{itemBebida.producto.precio}}</h3></ion-text>
              </div>

              <ion-fab horizontal="start" vertical="bottom" class="sumar">
                <ion-fab-button size="small" (click)="sumarProducto(itemBebida)">
                  <ion-icon name="add"></ion-icon>
                </ion-fab-button>
              </ion-fab>
              <ion-fab  vertical="bottom" class="numero">
                <ion-label>
                  <h2 class="fw-bold cantidadItem" *ngIf="itemBebida.cantidad < 10">
                    {{itemBebida.cantidad}}
                  </h2>
                  <h2 class="fw-bold cantidadItem10" *ngIf="itemBebida.cantidad >= 10">
                    {{itemBebida.cantidad}}
                  </h2>
                </ion-label>
              </ion-fab>
              <ion-fab horizontal="start" vertical="bottom">
                <ion-fab-button size="small" (click)="restarProducto(itemBebida)">
                  <ion-icon name="remove-outline"></ion-icon>
                </ion-fab-button>
              </ion-fab>

            </ion-item>
          </div>

        </ion-item-group>

        <ion-item-group>
          <ion-item-divider>
            <ion-label>
              <ion-text color="dark">
                <h2 class="fw-bold">POSTRES</h2>
              </ion-text>
            </ion-label>
          </ion-item-divider>

          <div *ngFor="let itemPostre of listadoPostres; index as i">
            <ion-item>

              <div class="nombreDescr">
                <ion-text><h4 class="ion-text-center fw-bold">{{itemPostre.producto.nombre}}</h4></ion-text>
                <ion-text class="opacity-75"><p class="ion-text-center">{{itemPostre.producto.descripcion}}</p></ion-text>
              </div>

              <div>

                <div id="collapseExample3{{i}}" class="carousel fotosProducto">
                  <div class="carousel-inner">
                    <div class="carousel-item active">
                      <img src="{{itemPostre.producto.img_src[0]}}" alt="..." width="160px" height="160px" class="img-menu">
                    </div>
                    <div class="carousel-item">
                      <img src="{{itemPostre.producto.img_src[1]}}" alt="..." width="160px" height="160px" class="img-menu">
                    </div>
                    <div class="carousel-item">
                      <img src="{{itemPostre.producto.img_src[2]}}" alt="..." width="160px" height="160px" class="img-menu">
                    </div>
                  </div>
                  <button class="carousel-control-prev" type="button" [attr.data-bs-target]="'#collapseExample3'+i" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                  </button>
                  <button class="carousel-control-next" type="button" [attr.data-bs-target]="'#collapseExample3'+i" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                  </button>
                </div>
                <ion-text><h6 class="ion-text-center fw-bold demora">Demora: {{itemPostre.producto.tiempo_elaboracion}} min</h6></ion-text>
                <ion-text><h3 class="ion-text-center fw-bold precio">${{itemPostre.producto.precio}}</h3></ion-text>
              </div>

              <ion-fab horizontal="start" vertical="bottom" class="sumar">
                <ion-fab-button size="small" (click)="sumarProducto(itemPostre)">
                  <ion-icon name="add"></ion-icon>
                </ion-fab-button>
              </ion-fab>
              <ion-fab  vertical="bottom" class="numero">
                <ion-label>
                  <h2 class="fw-bold cantidadItem" *ngIf="itemPostre.cantidad < 10">
                    {{itemPostre.cantidad}}
                  </h2>
                  <h2 class="fw-bold cantidadItem10" *ngIf="itemPostre.cantidad >= 10">
                    {{itemPostre.cantidad}}
                  </h2>
                </ion-label>
              </ion-fab>
              <ion-fab horizontal="start" vertical="bottom">
                <ion-fab-button size="small" (click)="restarProducto(itemPostre)">
                  <ion-icon name="remove-outline"></ion-icon>
                </ion-fab-button>
              </ion-fab>

            </ion-item>
          </div>

        </ion-item-group>
      </ion-list>
    </div>

  </div>
</ion-content>


<!-- SPINNER -->
<div *ngIf="spin" class="div-spin-logo">
  <img src="../../../assets/spinner/spinner.gif" alt="" class="spin-logo">
</div>


<!-- MODAL CARRITO -->
<ion-modal #modal trigger="open-modal2" [isOpen]="modalCarritoAbierto" class="modalcarrito">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Carrito</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="modalCarrito(false)" size="small">Volver al Menu</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>


    <ion-content>
      <div *ngIf="productosElegidos.length > 0">
        <ion-toolbar>
          <div class="realizarPedido">
            <ion-fab horizontal="center" vertical="center">
              <h1 class="valortotal">Total: $ {{valorTotal}}</h1>
            </ion-fab>
          </div>
        </ion-toolbar>
        <ion-toolbar>
          <ion-fab horizontal="center" vertical="center">
            <h1>Tiempo elaboración: {{tiempoEstimado}} min</h1>
          </ion-fab>
        </ion-toolbar>
        <ion-list *ngFor="let item of productosElegidos ; index as i">
          <ion-item>
            <ion-avatar slot="start">
              <img src="{{item.producto.img_src[0]}}" alt="..." width="100px" height="100px" class="img-menu">
            </ion-avatar>
            <ion-label>
              <h2>{{item.producto.nombre}}</h2>
            </ion-label>
            <ion-label slot="end">
              <h2 *ngIf="item.cantidad === 1">{{item.cantidad}} unidad</h2>
              <h2 *ngIf="item.cantidad !== 1">{{item.cantidad}} unidades</h2>
            </ion-label>
          </ion-item>
        </ion-list>

        <ion-fab horizontal="center" class="realizarPed">
          <ion-button (click)="realizarPedido()" size="large" class="botonrealizar">Realizar Pedido</ion-button>
        </ion-fab>


      </div>
      <div *ngIf="productosElegidos.length === 0">
        <ion-card>
          <ion-card-header>
            <ion-card-title color="light" class="ion-text-center">No hay productos seleccionados</ion-card-title>
          </ion-card-header>
        </ion-card>
      </div>
    </ion-content>


  </ng-template>
</ion-modal>


<!-- MODAL CHAT -->
<ion-modal #modal trigger="open-modal" [isOpen]="modalChatAbierto">
  <ng-template>

    <ion-toolbar>
      <ion-title>Chat - Mesa {{mesaUsuario}}</ion-title>
      <ion-buttons slot="end">
        <ion-button color="light" (click)="modalChat(false)">Cerrar</ion-button>
      </ion-buttons>
    </ion-toolbar>

    <ion-content>
      <ion-list *ngFor="let mensaje of listadoMensajes">
        <ion-item *ngIf=" mensaje.emisor === 'mozo' ">
          <ion-avatar slot="start">
            <ion-img src="../../../assets/icon/mozo-icon.jpeg"></ion-img>
          </ion-avatar>
          <ion-label>
            <h2>{{mensaje.mensaje}}</h2>
          </ion-label>
        </ion-item>

        <ion-item *ngIf=" mensaje.emisor === 'cliente' ">
          <ion-label slot="end">
            <h2>{{mensaje.mensaje}}</h2>
          </ion-label>
          <ion-avatar slot="end">
            <ion-img src="../../../assets/icon/cliente-icon.png"></ion-img>
          </ion-avatar>
        </ion-item>
      </ion-list>
    </ion-content>

    <ion-footer [translucent]="true">
      <ion-toolbar class="ion-text-center">
        <div class="input-consulta">
          <ion-textarea placeholder="Escribe un mensaje..." [(ngModel)]="mensaje"></ion-textarea>
        </div>
        <ion-button class="ion-margin-bottom" (click)="enviarMensaje()">
          <ion-text class="ion-margin-horizontal">Enviar Mensaje</ion-text>
          <ion-icon name="send-outline"></ion-icon>
        </ion-button>
      </ion-toolbar>
    </ion-footer>

  </ng-template>
</ion-modal>

